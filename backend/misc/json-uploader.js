const mongoose = require("mongoose");
require("./../../models/Uni");

/**
 * Function that uploads entries for each university in the
 * json data generated by python scripts
 * @param data JSON document generated by python script (read_unis)
 */
function uploadUnis(data) {
    const Uni = mongoose.model("Uni");

    console.log("Deleting all old unis!")
    Uni.deleteMany({}, () => {
    });

    for (let country_key in data) {
        const unis = data[country_key].unis;
        const country = data[country_key].pretty;
        for (let uni_key in unis) {
            const doc = {};
            doc.name_norm = uni_key;
            doc.name = unis[uni_key];
            doc.date_added = new Date();
            doc.country_norm = country_key;
            doc.country = country;

            const u = new Uni(doc);
            u.save()
                .then(() => {
                    console.log("Saved: \n" + u);
                })
                .catch(() => {
                    console.log("Failed: \n" + u);
                })
        }
    }
}

module.exports = {uploadUnis};